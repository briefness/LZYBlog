import{_ as i,o as a,c as n,ag as t}from"./chunks/framework.CbQjVMS6.js";const E=JSON.parse('{"title":"Coze 零基础精通系列 07：高级逻辑 (Code Nodes) —— 突破“无代码”的极限","description":"","frontmatter":{},"headers":[],"relativePath":"posts/coze/07_Advanced_Logic_Code.md","filePath":"posts/coze/07_Advanced_Logic_Code.md"}'),l={name:"posts/coze/07_Advanced_Logic_Code.md"};function e(h,s,o,p,r,k){return a(),n("div",null,[...s[0]||(s[0]=[t(`<h1 id="coze-零基础精通系列-07-高级逻辑-code-nodes-——-突破-无代码-的极限" tabindex="-1">Coze 零基础精通系列 07：高级逻辑 (Code Nodes) —— 突破“无代码”的极限 <a class="header-anchor" href="#coze-零基础精通系列-07-高级逻辑-code-nodes-——-突破-无代码-的极限" aria-label="Permalink to &quot;Coze 零基础精通系列 07：高级逻辑 (Code Nodes) —— 突破“无代码”的极限&quot;">​</a></h1><blockquote><p><strong>上一篇回顾</strong>：已用数据库存储数据。<br><strong>本篇目标</strong>：当“拖拽”无法满足需求时，用少量的代码（Code）实现精准控制，以及处理批量任务。</p></blockquote><hr><h2 id="_1-为什么-无代码-平台还需要写代码" tabindex="-1">1. 为什么“无代码”平台还需要写代码？ <a class="header-anchor" href="#_1-为什么-无代码-平台还需要写代码" aria-label="Permalink to &quot;1. 为什么“无代码”平台还需要写代码？&quot;">​</a></h2><p>即使是 GPT-4，也有它的弱点：</p><ul><li><strong>数学差</strong>：问 <code>3.1415 * 99933.2</code>，它经常算错。</li><li><strong>格式乱</strong>：处理复杂的 JSON 嵌套时，有时候提取字段不准确。</li><li><strong>逻辑绕</strong>：处理 &quot;if-else&quot; 还行，但处理 &quot;for 循环&quot;（比如把 10 条新闻逐条分析）就比较吃力。</li></ul><p>这时候，需要 <strong>代码节点 (Code Node)</strong>。它弥补了 LLM 在精确计算和逻辑控制上的短板。</p><h2 id="_2-核心原理-沙箱与循环" tabindex="-1">2. 核心原理：沙箱与循环 <a class="header-anchor" href="#_2-核心原理-沙箱与循环" aria-label="Permalink to &quot;2. 核心原理：沙箱与循环&quot;">​</a></h2><h3 id="_2-1-代码节点-code-node" tabindex="-1">2.1 代码节点 (Code Node) <a class="header-anchor" href="#_2-1-代码节点-code-node" aria-label="Permalink to &quot;2.1 代码节点 (Code Node)&quot;">​</a></h3><p>可以在 Coze 的工作流里插入一个运行 Python 或 JavaScript 的小盒子。</p><ul><li><strong>输入</strong>：上一个节点的 Output。</li><li><strong>处理</strong>：用标准的编程语法处理数据（如正则匹配、数学运算、列表操作）。</li><li><strong>输出</strong>：处理好的干净数据。</li></ul><blockquote><p>💡 <strong>进阶技巧</strong>：注意 <strong>沙箱限制</strong>。Coze 的代码节点通常无法访问外网（不能使用 <code>requests</code> 库请求外部 API），且只能使用平台预装的 Python/JS 库（如 <code>numpy</code>）。如需复杂网络请求，请使用插件。</p></blockquote><h3 id="_2-2-循环节点-loop-node" tabindex="-1">2.2 循环节点 (Loop Node) <a class="header-anchor" href="#_2-2-循环节点-loop-node" aria-label="Permalink to &quot;2.2 循环节点 (Loop Node)&quot;">​</a></h3><p>如果搜到了 10 篇网页，想把它们<strong>每一篇</strong>都读一遍并总结，普通工作流只能处理整个 List。 <strong>循环节点</strong>可以遍历这个 List，对<strong>每一个</strong> Item 执行一次相同的子工作流。</p><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Input[&quot;输入金额: 100 USD&quot;] --&gt; GetRate[&quot;插件: 获取实时汇率&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GetRate --&gt;|&quot;JSON: {rate: 7.21, time...}&quot;| CodeNode{&quot;代码节点: Python 计算&quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Python_Logic [Python 逻辑]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Process[&quot;result = amount * rate&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Round[&quot;result = round(result, 2)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CodeNode --&gt;|&quot;精确结果: 721.00&quot;| Output[输出]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style CodeNode fill:#d1c4e9,stroke:#512da8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style Python_Logic fill:#f3e5f5,stroke:#7b1fa2,stroke-dasharray: 5 5</span></span></code></pre></div><h2 id="_3-实战案例-精准-汇率计算器" tabindex="-1">3. 实战案例：精准“汇率计算器” <a class="header-anchor" href="#_3-实战案例-精准-汇率计算器" aria-label="Permalink to &quot;3. 实战案例：精准“汇率计算器”&quot;">​</a></h2><p>本节演示汇率换算，为确保精度，使用代码计算。</p><h3 id="第一步-获取数据" tabindex="-1">第一步：获取数据 <a class="header-anchor" href="#第一步-获取数据" aria-label="Permalink to &quot;第一步：获取数据&quot;">​</a></h3><ol><li>创建工作流。</li><li>Start 节点接收 <code>currency_from</code>, <code>currency_to</code>, <code>amount</code>。</li><li>添加 <strong>Google Finance</strong> 或类似插件，查询当前汇率。</li></ol><h3 id="第二步-编写代码" tabindex="-1">第二步：编写代码 <a class="header-anchor" href="#第二步-编写代码" aria-label="Permalink to &quot;第二步：编写代码&quot;">​</a></h3><ol><li>添加 <strong>Code</strong> 节点。</li><li>语言选择 <strong>Python</strong>。</li><li><strong>Input</strong>：添加变量 <code>rate</code> (从插件获取), <code>amount</code> (从 Start 获取)。</li><li><strong>代码编写</strong>：<div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args: Args) -&gt; Output:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    params </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args.params</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 强制让计算机做浮点运算，而不是让 AI 猜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;rate&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;amount&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 计算结果，保留4位小数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    converted </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rate</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    formatted_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> round</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(converted, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 构造返回值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ret: Output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;result&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: formatted_result,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">amount</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 换算结果为 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">formatted_result</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ret</span></span></code></pre></div></li></ol><h3 id="第三步-输出结果" tabindex="-1">第三步：输出结果 <a class="header-anchor" href="#第三步-输出结果" aria-label="Permalink to &quot;第三步：输出结果&quot;">​</a></h3><p>LLM 会拿到这个精准的数字，再把它包装成好听的话回复给用户。</p><hr><h2 id="_4-进阶玩法-批处理-batch-processing" tabindex="-1">4. 进阶玩法：批处理 (Batch Processing) <a class="header-anchor" href="#_4-进阶玩法-批处理-batch-processing" aria-label="Permalink to &quot;4. 进阶玩法：批处理 (Batch Processing)&quot;">​</a></h2><p>假设构建一个“公众号爆款标题打分器”。</p><ol><li><strong>输入</strong>：用户一次性发送 5 个标题。</li><li><strong>处理</strong>：需要对这 5 个标题<strong>分别</strong>进行多维度的评分（吸引力、情绪值、关键词）。</li><li><strong>循环</strong>： <ul><li>使用 <strong>Loop</strong> 节点包裹住“评分 LLM”。</li><li>Coze 会自动把 5 个标题拆开，跑 5 次评分。</li><li>最后把 5 个结果打包成一个 List 返回。</li></ul></li></ol><hr><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><ul><li><strong>LLM</strong> 负责创意、理解、模糊处理。</li><li><strong>Code</strong> 负责计算、逻辑、精确处理。</li></ul><p>Bot 的能力已经非常完善。但目前它通常以单体形式存在。 下一篇，将进入 <strong>多智能体 (Multi-Agent)</strong> 模式，介绍如何让多个 Bot 协同工作。</p>`,31)])])}const g=i(l,[["render",e]]);export{E as __pageData,g as default};
