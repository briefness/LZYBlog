import{_ as a,o as i,c as n,ag as t}from"./chunks/framework.CbQjVMS6.js";const c=JSON.parse('{"title":"é¸¿è’™å¼€å‘è¿›é˜¶ï¼ˆå…­ï¼‰ï¼šè‡ªå®šä¹‰ç»˜å›¾ (Canvas)","description":"","frontmatter":{},"headers":[],"relativePath":"posts/harmonyos/Articles/Drawing.md","filePath":"posts/harmonyos/Articles/Drawing.md"}'),l={name:"posts/harmonyos/Articles/Drawing.md"};function e(p,s,h,r,o,k){return i(),n("div",null,[...s[0]||(s[0]=[t(`<h1 id="é¸¿è’™å¼€å‘è¿›é˜¶-å…­-è‡ªå®šä¹‰ç»˜å›¾-canvas" tabindex="-1">é¸¿è’™å¼€å‘è¿›é˜¶ï¼ˆå…­ï¼‰ï¼šè‡ªå®šä¹‰ç»˜å›¾ (Canvas) <a class="header-anchor" href="#é¸¿è’™å¼€å‘è¿›é˜¶-å…­-è‡ªå®šä¹‰ç»˜å›¾-canvas" aria-label="Permalink to &quot;é¸¿è’™å¼€å‘è¿›é˜¶ï¼ˆå…­ï¼‰ï¼šè‡ªå®šä¹‰ç»˜å›¾ (Canvas)&quot;">â€‹</a></h1><blockquote><p>ğŸ”— <strong>é¡¹ç›®åœ°å€</strong>ï¼š<a href="https://github.com/briefness/HarmonyDemo" target="_blank" rel="noreferrer">https://github.com/briefness/HarmonyDemo</a></p></blockquote><blockquote><p>å½“æ ‡å‡†ç»„ä»¶æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <strong>Canvas</strong>ã€‚</p></blockquote><h2 id="ä¸€ã€ç†è®ºåŸºç¡€-å›¾å½¢å¼•æ“" tabindex="-1">ä¸€ã€ç†è®ºåŸºç¡€ï¼šå›¾å½¢å¼•æ“ <a class="header-anchor" href="#ä¸€ã€ç†è®ºåŸºç¡€-å›¾å½¢å¼•æ“" aria-label="Permalink to &quot;ä¸€ã€ç†è®ºåŸºç¡€ï¼šå›¾å½¢å¼•æ“&quot;">â€‹</a></h2><p>HarmonyOS çš„ 2D ç»˜å›¾å¼•æ“æ”¯æŒæ ‡å‡† Canvas APIï¼Œåº•å±‚çš„ <strong>DisplayList</strong> æœºåˆ¶æå‡äº†æ¸²æŸ“æ•ˆç‡ã€‚</p><h3 id="_1-1-displaylist-æ˜¾ç¤ºåˆ—è¡¨" tabindex="-1">1.1 DisplayList (æ˜¾ç¤ºåˆ—è¡¨) <a class="header-anchor" href="#_1-1-displaylist-æ˜¾ç¤ºåˆ—è¡¨" aria-label="Permalink to &quot;1.1 DisplayList (æ˜¾ç¤ºåˆ—è¡¨)&quot;">â€‹</a></h3><p>å½“è°ƒç”¨ <code>ctx.lineTo(...)</code> æ—¶ï¼Œç³»ç»Ÿæ²¡æœ‰ç«‹å³æ“ä½œåƒç´ å†…å­˜ï¼ˆå…‰æ …åŒ–ï¼‰ï¼Œè€Œæ˜¯åœ¨<strong>å½•åˆ¶æŒ‡ä»¤</strong>ã€‚è¿™äº›æŒ‡ä»¤è¢«å­˜å‚¨åœ¨ <strong>DisplayList</strong> ä¸­ã€‚</p><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    JS[&quot;JS è°ƒç”¨ (ctx.lineTo)&quot;] --&gt;|å½•åˆ¶| DL(&quot;DisplayList (æŒ‡ä»¤é›†)&quot;)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DL --&gt;|æäº¤| RT{&quot;æ¸²æŸ“çº¿ç¨‹&quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RT --&gt;|Skia/OpenGL| GPU[&quot;GPU å…‰æ …åŒ–&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GPU --&gt;|Frame| Screen[&quot;å±å¹•&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style JS fill:#f9f,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style DL fill:#bbf,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style GPU fill:#9f9,stroke:#333</span></span></code></pre></div><p>å½“è¿™ä¸€å¸§ç»“æŸæ—¶ï¼ŒDisplayList è¢«å‘é€ç»™ <strong>RenderThread</strong> æˆ– GPU å›æ”¾ã€‚ <strong>ä¼˜åŠ¿</strong>ï¼š</p><ol><li><strong>éé˜»å¡</strong>: JS çº¿ç¨‹å½•åˆ¶æŒ‡ä»¤é€Ÿåº¦å¿«ã€‚</li><li><strong>ç¡¬ä»¶åŠ é€Ÿ</strong>: å¤æ‚çš„æ¸å˜ã€é˜´å½±å¯ç”± GPU Shader å¤„ç†ã€‚</li></ol><h2 id="äºŒã€canvas-åŸºç¡€" tabindex="-1">äºŒã€Canvas åŸºç¡€ <a class="header-anchor" href="#äºŒã€canvas-åŸºç¡€" aria-label="Permalink to &quot;äºŒã€Canvas åŸºç¡€&quot;">â€‹</a></h2><p>HarmonyOS çš„ Canvas API ä¸ Web Canvas (HTML5) é«˜åº¦ä¸€è‡´ã€‚</p><h3 id="_2-1-åæ ‡ç³»" tabindex="-1">2.1 åæ ‡ç³» <a class="header-anchor" href="#_2-1-åæ ‡ç³»" aria-label="Permalink to &quot;2.1 åæ ‡ç³»&quot;">â€‹</a></h3><ul><li><strong>åŸç‚¹ (0,0)</strong>: å·¦ä¸Šè§’ã€‚</li><li><strong>X è½´</strong>: å‘å³å¢åŠ ã€‚</li><li><strong>Y è½´</strong>: å‘ä¸‹å¢åŠ ã€‚</li></ul><h2 id="ä¸‰ã€å®æˆ˜æ¡ˆä¾‹-åŠ¨æ€ä»ªè¡¨ç›˜" tabindex="-1">ä¸‰ã€å®æˆ˜æ¡ˆä¾‹ï¼šåŠ¨æ€ä»ªè¡¨ç›˜ <a class="header-anchor" href="#ä¸‰ã€å®æˆ˜æ¡ˆä¾‹-åŠ¨æ€ä»ªè¡¨ç›˜" aria-label="Permalink to &quot;ä¸‰ã€å®æˆ˜æ¡ˆä¾‹ï¼šåŠ¨æ€ä»ªè¡¨ç›˜&quot;">â€‹</a></h2><p>æœ¬èŠ‚å°†ç»˜åˆ¶ä¸€ä¸ªå¸¦æ¸å˜è‰²çš„åœ†å½¢è¿›åº¦æ¡ï¼š</p><h3 id="_3-1-å…³é”®-api-è§£æ" tabindex="-1">3.1 å…³é”® API è§£æ <a class="header-anchor" href="#_3-1-å…³é”®-api-è§£æ" aria-label="Permalink to &quot;3.1 å…³é”® API è§£æ&quot;">â€‹</a></h3><ul><li><code>ctx.arc(x, y, r, startAngle, endAngle)</code>: ç”»åœ†å¼§ã€‚æ³¨æ„è§’åº¦ä½¿ç”¨ <strong>å¼§åº¦</strong> (Radians)ã€‚</li><li><code>ctx.createLinearGradient(...)</code>: åˆ›å»ºæ¸å˜ç¬”åˆ·ã€‚</li><li><code>ctx.clearRect(...)</code>: <strong>åŠ¨ç”»æ¯ä¸€å¸§ä¹‹å‰å¿…é¡»æ¸…ç©ºç”»å¸ƒ</strong>ã€‚å¦åˆ™ç”»é¢ä¼šé‡å ã€‚</li></ul><h2 id="å››ã€æ€§èƒ½æ·±åº¦ä¼˜åŒ–" tabindex="-1">å››ã€æ€§èƒ½æ·±åº¦ä¼˜åŒ– <a class="header-anchor" href="#å››ã€æ€§èƒ½æ·±åº¦ä¼˜åŒ–" aria-label="Permalink to &quot;å››ã€æ€§èƒ½æ·±åº¦ä¼˜åŒ–&quot;">â€‹</a></h2><p>Canvas ç»˜å›¾å¼ºå¤§ï¼Œä½†æ»¥ç”¨ä¼šå¯¼è‡´æ‰å¸§ã€‚</p><h3 id="_4-1-é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡" tabindex="-1">4.1 é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡ <a class="header-anchor" href="#_4-1-é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡" aria-label="Permalink to &quot;4.1 é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âŒ é”™è¯¯ç¤ºèŒƒï¼šæ¯ä¸€å¸§éƒ½ new å¯¹è±¡ï¼Œå¯¼è‡´ GC é¢‘ç¹è§¦å‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> draw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> grad</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createLinearGradient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… æ­£ç¡®ç¤ºèŒƒï¼šå¤ç”¨å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> grad</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createLinearGradient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> draw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ctx.fillStyle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> grad;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_4-2-ç¦»å±æ¸²æŸ“-offscreencanvas" tabindex="-1">4.2 ç¦»å±æ¸²æŸ“ (OffscreenCanvas) <a class="header-anchor" href="#_4-2-ç¦»å±æ¸²æŸ“-offscreencanvas" aria-label="Permalink to &quot;4.2 ç¦»å±æ¸²æŸ“ (OffscreenCanvas)&quot;">â€‹</a></h3><p>å¦‚æœèƒŒæ™¯å¤æ‚ä¸”é™æ­¢ï¼š</p><ol><li>åœ¨ <strong>OffscreenCanvas</strong> ä¸Šç»˜åˆ¶èƒŒæ™¯ï¼ˆç¼“å­˜ä¸º Bitmapï¼‰ã€‚</li><li>åœ¨ä¸»å¾ªç¯ä¸­ï¼Œä½¿ç”¨ <code>ctx.drawImage(offscreen)</code> è´´å›¾ã€‚ è¿™æ˜¯<strong>ç©ºé—´æ¢æ—¶é—´</strong>çš„ç­–ç•¥ã€‚</li></ol><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Init [&quot;åˆå§‹åŒ–é˜¶æ®µ&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Off[ç¦»å±ç”»å¸ƒ] --&gt;|ç»˜åˆ¶å¤æ‚èƒŒæ™¯| Cache[ä½å›¾ç¼“å­˜]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Loop [&quot;åŠ¨ç”»å¾ªç¯ (60Hz)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Clear[æ¸…ç©ºä¸»ç”»å¸ƒ] --&gt; DrawBG[&quot;ç»˜åˆ¶å›¾ç‰‡ (ç¼“å­˜)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        DrawBG --&gt; DrawFG[ç»˜åˆ¶åŠ¨æ€å‰æ™¯]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        DrawFG --&gt; Commit[æäº¤]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Cache -.-&gt;|å¤ç”¨| DrawBG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style Cache fill:#bbf,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style Loop fill:#e6fffa,stroke:#333</span></span></code></pre></div><h2 id="äº”ã€æ€»ç»“" tabindex="-1">äº”ã€æ€»ç»“ <a class="header-anchor" href="#äº”ã€æ€»ç»“" aria-label="Permalink to &quot;äº”ã€æ€»ç»“&quot;">â€‹</a></h2><p>Canvas æä¾›äº†å¼ºå¤§çš„ç»˜å›¾èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿè¦æ±‚ç†è§£å›¾å½¢ç®¡çº¿ã€‚</p><ul><li>DisplayList æœºåˆ¶æå‡äº†é€Ÿåº¦ã€‚</li><li>æ§åˆ¶ GC é¢‘ç‡æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ã€‚</li></ul><p>ä¸‹ä¸€ç¯‡ï¼Œå°†æ¢è®¨<strong>ç»„ä»¶åŒ–</strong>æ¶æ„ï¼Œä»‹ç»å¦‚ä½•ä¼˜é›…åœ°ç»„ç»‡å¤§å‹é¡¹ç›®ä»£ç ã€‚</p>`,30)])])}const E=a(l,[["render",e]]);export{c as __pageData,E as default};
