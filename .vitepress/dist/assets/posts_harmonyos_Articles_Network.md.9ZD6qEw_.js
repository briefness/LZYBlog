import{_ as i,o as a,c as n,ag as t}from"./chunks/framework.CbQjVMS6.js";const c=JSON.parse('{"title":"é¸¿è’™å¼€å‘è¿›é˜¶ï¼ˆå…«ï¼‰ï¼šé«˜æ€§èƒ½ç½‘ç»œè¯·æ±‚ (RCP) ä¸æ•°æ®äº¤äº’","description":"","frontmatter":{},"headers":[],"relativePath":"posts/harmonyos/Articles/Network.md","filePath":"posts/harmonyos/Articles/Network.md"}'),e={name:"posts/harmonyos/Articles/Network.md"};function l(p,s,h,r,k,o){return a(),n("div",null,[...s[0]||(s[0]=[t(`<h1 id="é¸¿è’™å¼€å‘è¿›é˜¶-å…«-é«˜æ€§èƒ½ç½‘ç»œè¯·æ±‚-rcp-ä¸æ•°æ®äº¤äº’" tabindex="-1">é¸¿è’™å¼€å‘è¿›é˜¶ï¼ˆå…«ï¼‰ï¼šé«˜æ€§èƒ½ç½‘ç»œè¯·æ±‚ (RCP) ä¸æ•°æ®äº¤äº’ <a class="header-anchor" href="#é¸¿è’™å¼€å‘è¿›é˜¶-å…«-é«˜æ€§èƒ½ç½‘ç»œè¯·æ±‚-rcp-ä¸æ•°æ®äº¤äº’" aria-label="Permalink to &quot;é¸¿è’™å¼€å‘è¿›é˜¶ï¼ˆå…«ï¼‰ï¼šé«˜æ€§èƒ½ç½‘ç»œè¯·æ±‚ (RCP) ä¸æ•°æ®äº¤äº’&quot;">â€‹</a></h1><blockquote><p>ğŸ”— <strong>é¡¹ç›®åœ°å€</strong>ï¼š<a href="https://github.com/briefness/HarmonyDemo" target="_blank" rel="noreferrer">https://github.com/briefness/HarmonyDemo</a></p></blockquote><blockquote><p><strong>æ›´æ–°è¯´æ˜</strong>ï¼šæœ¬æ–‡å°†ä»‹ç» RCP (Remote Communication Kit) çš„ <strong>HTTP/2 å¤šè·¯å¤ç”¨</strong> å’Œ <strong>è¿æ¥æ± </strong> æœºåˆ¶ã€‚</p></blockquote><h2 id="ä¸€ã€ç†è®ºåŸºç¡€-ä¸ºä»€ä¹ˆ-rcp-æ¯”-http-æ¨¡å—å¿«" tabindex="-1">ä¸€ã€ç†è®ºåŸºç¡€ï¼šä¸ºä»€ä¹ˆ RCP æ¯” http æ¨¡å—å¿«ï¼Ÿ <a class="header-anchor" href="#ä¸€ã€ç†è®ºåŸºç¡€-ä¸ºä»€ä¹ˆ-rcp-æ¯”-http-æ¨¡å—å¿«" aria-label="Permalink to &quot;ä¸€ã€ç†è®ºåŸºç¡€ï¼šä¸ºä»€ä¹ˆ RCP æ¯” http æ¨¡å—å¿«ï¼Ÿ&quot;">â€‹</a></h2><p>HarmonyOS NEXT æä¾›äº†ä¸¤å¥—æ–¹æ¡ˆï¼šJsCore å®ç°çš„ <code>http</code> å’Œ C++ å†…æ ¸å®ç°çš„ <code>rcp</code>ã€‚</p><h3 id="_1-1-http-2-å¤šè·¯å¤ç”¨-multiplexing" tabindex="-1">1.1 HTTP/2 å¤šè·¯å¤ç”¨ (Multiplexing) <a class="header-anchor" href="#_1-1-http-2-å¤šè·¯å¤ç”¨-multiplexing" aria-label="Permalink to &quot;1.1 HTTP/2 å¤šè·¯å¤ç”¨ (Multiplexing)&quot;">â€‹</a></h3><p>ä¼ ç»Ÿçš„ HTTP/1.1 å­˜åœ¨**é˜Ÿå¤´é˜»å¡ (Head-of-Line Blocking)**é—®é¢˜ã€‚æµè§ˆå™¨é™åˆ¶åŒä¸€ä¸ªåŸŸååªèƒ½æœ‰å°‘æ•° TCP è¿æ¥ã€‚</p><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SubGraph_H1[&quot;HTTP/1.1&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Req1[&quot;è¯·æ±‚ 1&quot;] --&gt;|ç­‰å¾…| Conn1[&quot;TCP è¿æ¥ 1&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Req2[&quot;è¯·æ±‚ 2&quot;] --&gt;|ç­‰å¾…| Conn1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SubGraph_H2[&quot;RCP (HTTP/2)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Stream1[&quot;è¯·æ±‚ 1 (æµ)&quot;] --&gt;|å¹¶å‘| Pipe[&quot;TCP è¿æ¥ (ç®¡é“)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Stream2[&quot;è¯·æ±‚ 2 (æµ)&quot;] --&gt;|å¹¶å‘| Pipe</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style SubGraph_H2 fill:#e6fffa,stroke:#333</span></span></code></pre></div><p>RCP é»˜è®¤æ”¯æŒ <strong>HTTP/2</strong>ï¼š</p><ul><li><strong>äºŒè¿›åˆ¶åˆ†å¸§</strong>: æ•°æ®ä¸å†æ˜¯æ–‡æœ¬ï¼Œè€Œæ˜¯äºŒè¿›åˆ¶å¸§ã€‚</li><li><strong>å¤šè·¯å¤ç”¨</strong>: è¯·æ±‚å…±äº«<strong>åŒä¸€ä¸ª</strong> TCP è¿æ¥ï¼Œäº’ä¸å¹²æ‰°ã€‚</li></ul><h3 id="_1-2-è¿æ¥æ± -connection-pooling" tabindex="-1">1.2 è¿æ¥æ±  (Connection Pooling) <a class="header-anchor" href="#_1-2-è¿æ¥æ± -connection-pooling" aria-label="Permalink to &quot;1.2 è¿æ¥æ±  (Connection Pooling)&quot;">â€‹</a></h3><p>RCP å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª TCP è¿æ¥æ± ã€‚ è°ƒç”¨ <code>session.fetch()</code> æ—¶ï¼š</p><ol><li>æ£€æŸ¥æ± å†…æ˜¯å¦æœ‰è¿æ¥åˆ°ç›®æ ‡åŸŸåçš„é—²ç½®è¿æ¥ã€‚</li><li>æœ‰ -&gt; ç›´æ¥å¤ç”¨ (0-RTT)ã€‚</li><li>æ—  -&gt; å»ºç«‹æ–°è¿æ¥å¹¶å­˜å…¥æ± ã€‚</li></ol><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Req[&quot;è¯·æ±‚&quot;] --&gt; Pool{&quot;è¿æ¥æ± &quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Pool --&gt;|Check Idle| Check{&quot;æœ‰ç©ºé—²è¿æ¥?&quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Check --&gt;|Yes| Reuse[&quot;å¤ç”¨è¿æ¥ (0-RTT)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Check --&gt;|No| Create[&quot;TCP Handshake (å»ºç«‹æ–°è¿æ¥)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Create --&gt; Store[&quot;å­˜å…¥è¿æ¥æ± &quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Reuse --&gt; Send[&quot;å‘é€è¯·æ±‚&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Store --&gt; Send</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style Pool fill:#bbf,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style Reuse fill:#9f9,stroke:#333</span></span></code></pre></div><p><strong>ç»“è®º</strong>: é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼ŒRCP çš„ååé‡ä¼˜äº http æ¨¡å—ã€‚</p><h2 id="äºŒã€æ ¸å¿ƒæ¶æ„-session-ä¸-request" tabindex="-1">äºŒã€æ ¸å¿ƒæ¶æ„ï¼šSession ä¸ Request <a class="header-anchor" href="#äºŒã€æ ¸å¿ƒæ¶æ„-session-ä¸-request" aria-label="Permalink to &quot;äºŒã€æ ¸å¿ƒæ¶æ„ï¼šSession ä¸ Request&quot;">â€‹</a></h2><p>Session æŒæœ‰è¿æ¥æ± ã€‚ <strong>åº”ä½¿ç”¨å…¨å±€å•ä¾‹ Session</strong>ï¼Œé¿å…ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºæ–°çš„ Sessionã€‚</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> session</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rcp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createSession</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers: { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Bearer ...&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  requestConfiguration: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    transfer: { timeout: { connectMs: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="ä¸‰ã€è¿›é˜¶æŠ€å·§-æ‹¦æˆªå™¨-interceptors" tabindex="-1">ä¸‰ã€è¿›é˜¶æŠ€å·§ï¼šæ‹¦æˆªå™¨ (Interceptors) <a class="header-anchor" href="#ä¸‰ã€è¿›é˜¶æŠ€å·§-æ‹¦æˆªå™¨-interceptors" aria-label="Permalink to &quot;ä¸‰ã€è¿›é˜¶æŠ€å·§ï¼šæ‹¦æˆªå™¨ (Interceptors)&quot;">â€‹</a></h2><p>è™½ç„¶ RCP åŸç”Ÿæ‹¦æˆªå™¨è¿˜åœ¨æ¼”è¿›ï¼Œä½†å¯ä»¥å°è£… Service å±‚æ¥å®ç°ç±»ä¼¼ Axios çš„æ‹¦æˆªã€‚</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. è¯·æ±‚æ‹¦æˆªï¼šæ³¨å…¥ Token</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. å“åº”æ‹¦æˆªï¼šç»Ÿä¸€å¤„ç† 401</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (resp.statusCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 401</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // Refresh Token Logic...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant UI as é¡µé¢/ç»„ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant Service as HttpService</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant RCP as RCP ä¼šè¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant Server as åç«¯</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    UI-&gt;&gt;Service: request(url)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Service-&gt;&gt;Service: æ‹¦æˆªå™¨: æ·»åŠ  Token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Service-&gt;&gt;RCP: fetch(url, headers)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RCP-&gt;&gt;Server: HTTP è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Server--&gt;&gt;RCP: HTTP 401 Unauthorized</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RCP--&gt;&gt;Service: å“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Service-&gt;&gt;Service: æ‹¦æˆªå™¨: 401 æ£€æµ‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Service-&gt;&gt;RCP: åˆ·æ–° Token (é‡è¯•)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RCP-&gt;&gt;Server: HTTP è¯·æ±‚ (æ–° Token)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Server--&gt;&gt;RCP: HTTP 200 OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RCP--&gt;&gt;Service: æœ€ç»ˆå“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Service--&gt;&gt;UI: æ•°æ®</span></span></code></pre></div><h2 id="å››ã€çº¿ç¨‹æ¨¡å‹" tabindex="-1">å››ã€çº¿ç¨‹æ¨¡å‹ <a class="header-anchor" href="#å››ã€çº¿ç¨‹æ¨¡å‹" aria-label="Permalink to &quot;å››ã€çº¿ç¨‹æ¨¡å‹&quot;">â€‹</a></h2><p>ArkTS æ˜¯å•çº¿ç¨‹çš„ï¼Œä½† <strong>RCP çš„ç½‘ç»œ I/O æ˜¯åœ¨ç‹¬ç«‹çš„å†…æ ¸çº¿ç¨‹ä¸­æ‰§è¡Œçš„</strong>ã€‚ è¿™æ„å‘³ç€ï¼Œåˆ©ç”¨ RCP ä¸‹è½½å¤§æ–‡ä»¶æ—¶ï¼Œä¸»çº¿ç¨‹å‡ ä¹æ²¡æœ‰ CPU è´Ÿè½½ï¼Œä¾ç„¶å¯ä»¥æµç•…å“åº”ç”¨æˆ·æ“ä½œã€‚</p><h2 id="äº”ã€æ€»ç»“" tabindex="-1">äº”ã€æ€»ç»“ <a class="header-anchor" href="#äº”ã€æ€»ç»“" aria-label="Permalink to &quot;äº”ã€æ€»ç»“&quot;">â€‹</a></h2><p>ç½‘ç»œå±‚æ˜¯ App çš„åŸºç¡€æ¶æ„ã€‚</p><ul><li><strong>åè®®</strong>: ä¼˜å…ˆä½¿ç”¨æ”¯æŒ HTTP/2 çš„æœåŠ¡ç«¯ã€‚</li><li><strong>æ¶æ„</strong>: å…¨å±€å¤ç”¨ Sessionã€‚</li><li><strong>é€‰å‹</strong>: æ¨èä½¿ç”¨ <code>rcp</code> æ›¿ä»£ <code>http</code>ã€‚</li></ul><p>ä¸‹ä¸€ç¯‡ï¼Œå°†æ·±å…¥ <strong>æœ¬åœ°æŒä¹…åŒ– (Persistence)</strong>ï¼Œæ¢è®¨å…³ç³»å‹æ•°æ®åº“ RDB å¦‚ä½•é«˜æ•ˆç®¡ç†æ•°æ®ã€‚</p>`,28)])])}const g=i(e,[["render",l]]);export{c as __pageData,g as default};
