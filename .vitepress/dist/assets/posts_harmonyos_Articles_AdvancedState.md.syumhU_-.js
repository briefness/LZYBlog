import{_ as a,o as i,c as t,ag as e}from"./chunks/framework.CbQjVMS6.js";const E=JSON.parse('{"title":"é¸¿è’™å¼€å‘è¿›é˜¶ï¼ˆåï¼‰ï¼šçŠ¶æ€ç®¡ç† V2","description":"","frontmatter":{},"headers":[],"relativePath":"posts/harmonyos/Articles/AdvancedState.md","filePath":"posts/harmonyos/Articles/AdvancedState.md"}'),n={name:"posts/harmonyos/Articles/AdvancedState.md"};function l(p,s,h,o,r,k){return i(),t("div",null,[...s[0]||(s[0]=[e(`<h1 id="é¸¿è’™å¼€å‘è¿›é˜¶-å-çŠ¶æ€ç®¡ç†-v2" tabindex="-1">é¸¿è’™å¼€å‘è¿›é˜¶ï¼ˆåï¼‰ï¼šçŠ¶æ€ç®¡ç† V2 <a class="header-anchor" href="#é¸¿è’™å¼€å‘è¿›é˜¶-å-çŠ¶æ€ç®¡ç†-v2" aria-label="Permalink to &quot;é¸¿è’™å¼€å‘è¿›é˜¶ï¼ˆåï¼‰ï¼šçŠ¶æ€ç®¡ç† V2&quot;">â€‹</a></h1><blockquote><p>ğŸ”— <strong>é¡¹ç›®åœ°å€</strong>ï¼š<a href="https://github.com/briefness/HarmonyDemo" target="_blank" rel="noreferrer">https://github.com/briefness/HarmonyDemo</a></p></blockquote><blockquote><p><strong>æ›´æ–°è¯´æ˜</strong>ï¼šæœ¬æ–‡å°†å¯¹æ¯” V1 ä¸ V2 çš„åŒºåˆ«ï¼Œè§£æ <strong>Proxy ä»£ç†æ¨¡å¼</strong> å’Œ <strong>ç»†ç²’åº¦ä¾èµ–æ”¶é›†</strong> åŸç†ã€‚</p></blockquote><h2 id="ä¸€ã€ç†è®ºåŸºç¡€-proxy-vs-getter-setter" tabindex="-1">ä¸€ã€ç†è®ºåŸºç¡€ï¼šProxy vs Getter/Setter <a class="header-anchor" href="#ä¸€ã€ç†è®ºåŸºç¡€-proxy-vs-getter-setter" aria-label="Permalink to &quot;ä¸€ã€ç†è®ºåŸºç¡€ï¼šProxy vs Getter/Setter&quot;">â€‹</a></h2><h3 id="_1-1-v1-state-çš„é™åˆ¶" tabindex="-1">1.1 V1 (@State) çš„é™åˆ¶ <a class="header-anchor" href="#_1-1-v1-state-çš„é™åˆ¶" aria-label="Permalink to &quot;1.1 V1 (@State) çš„é™åˆ¶&quot;">â€‹</a></h3><p>V1 ä½¿ç”¨ <code>Object.defineProperty</code> (ç±»ä¼¼ Vue 2) æˆ–ç®€å•çš„ Setter åŠ«æŒã€‚</p><ul><li><strong>æµ…å±‚ç›‘å¬</strong>: åªèƒ½ç›‘å¬åˆ° <code>this.obj = newObj</code>ã€‚</li><li><strong>æ•°ç»„ç¼ºé™·</strong>: æ— æ³•ç›‘å¬åˆ° <code>arr[0] = 1</code> çš„ç´¢å¼•èµ‹å€¼ã€‚</li><li><strong>æ›´æ–°ç²’åº¦</strong>: ç²—çŠ·ã€‚ä¸€æ—¦å˜åŒ–ï¼Œæ•´ä¸ªç»„ä»¶å…³è”çš„ <code>build()</code> é‡æ–°æ‰§è¡Œã€‚</li></ul><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SubGraph_V1[&quot;V1 (@State)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Data1[&quot;æ•°æ®å˜åŒ– (this.obj.x = 1)&quot;] --&gt;|Trigger| Comp1[&quot;ç»„ä»¶é‡ç»˜&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Comp1 --&gt;|Diff| Child1[&quot;å­ç»„ä»¶ A&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Comp1 --&gt;|Diff| Child2[&quot;å­ç»„ä»¶ B&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SubGraph_V2[&quot;V2 (@ObservedV2)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Data2[&quot;æ•°æ®å˜åŒ– (this.obj.x = 1)&quot;] --&gt;|Trigger| Node1[&quot;ç²¾ç¡®æ›´æ–°&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Node1 --&gt;|Update| TextNode[&quot;Text ç»„ä»¶&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style SubGraph_V2 fill:#e6fffa,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style TextNode fill:#9f9,stroke:#333</span></span></code></pre></div><h3 id="_1-2-v2-observedv2-çš„æœºåˆ¶" tabindex="-1">1.2 V2 (@ObservedV2) çš„æœºåˆ¶ <a class="header-anchor" href="#_1-2-v2-observedv2-çš„æœºåˆ¶" aria-label="Permalink to &quot;1.2 V2 (@ObservedV2) çš„æœºåˆ¶&quot;">â€‹</a></h3><p>V2 åŸºäº JS å¼•æ“åŸç”Ÿçš„ <strong>Proxy</strong> (ç±»ä¼¼ Vue 3)ã€‚</p><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    A[&quot;è®¿é—®å±æ€§ (Get)&quot;] --&gt;|æ‹¦æˆª| P{&quot;Proxy ä»£ç†&quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    P --&gt;|è®°å½•ä¾èµ–| D[&quot;ä¾èµ–æ”¶é›†å™¨&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    M[&quot;ä¿®æ”¹å±æ€§ (Set)&quot;] --&gt;|æ‹¦æˆª| P</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    P --&gt;|é€šçŸ¥æ›´æ–°| T[&quot;ç²¾å‡†åˆ·æ–°&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    T --&gt;|åªæ›´æ–° Text| U[&quot;UI ç»„ä»¶&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style P fill:#f96,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style D fill:#bbf,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style T fill:#9f9,stroke:#333</span></span></code></pre></div><ol><li><p><strong>ä»£ç†æ‹¦æˆª</strong>: è®¿é—® <code>this.user.name</code> æ—¶ï¼ŒProxy æ‹¦æˆª <code>get</code> æ“ä½œã€‚ ä¿®æ”¹ <code>this.user.name = &#39;X&#39;</code> æ—¶ï¼ŒProxy æ‹¦æˆª <code>set</code> æ“ä½œã€‚</p></li><li><p><strong>ä¾èµ–æ”¶é›† (Dependency Collection)</strong>: åœ¨ <code>build()</code> æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¡†æ¶è®°å½•ä¸‹ï¼šâ€œç»„ä»¶ A çš„ Text B è¯»å–äº† <code>user.name</code>â€ã€‚ è¿™å»ºç«‹äº†ä¸€ä¸ªç²¾ç¡®åˆ° <strong>å±æ€§çº§</strong> çš„ä¾èµ–å›¾ã€‚</p></li><li><p><strong>ç²¾å‡†åˆ·æ–°</strong>: å½“ <code>user.name</code> å˜åŒ–ï¼Œæ¡†æ¶åªæ›´æ–° Text Bï¼Œ<strong>ä¸</strong>é‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶ Aã€‚</p></li></ol><h2 id="äºŒã€æ ¸å¿ƒç‰¹æ€§" tabindex="-1">äºŒã€æ ¸å¿ƒç‰¹æ€§ <a class="header-anchor" href="#äºŒã€æ ¸å¿ƒç‰¹æ€§" aria-label="Permalink to &quot;äºŒã€æ ¸å¿ƒç‰¹æ€§&quot;">â€‹</a></h2><h3 id="_2-1-å…¨æ·±åº¦ç›‘å¬-deep-observation" tabindex="-1">2.1 å…¨æ·±åº¦ç›‘å¬ (Deep Observation) <a class="header-anchor" href="#_2-1-å…¨æ·±åº¦ç›‘å¬-deep-observation" aria-label="Permalink to &quot;2.1 å…¨æ·±åº¦ç›‘å¬ (Deep Observation)&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@ObservedV2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> A</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  @Trace </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> B</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> B</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@ObservedV2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> B</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  @Trace </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// UI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.a.b.c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è‡ªåŠ¨ä» c -&gt; b -&gt; a å»ºç«‹ä¾èµ–é“¾</span></span></code></pre></div><h3 id="_2-2-å…¨æ•°ç»„æ”¯æŒ" tabindex="-1">2.2 å…¨æ•°ç»„æ”¯æŒ <a class="header-anchor" href="#_2-2-å…¨æ•°ç»„æ”¯æŒ" aria-label="Permalink to &quot;2.2 å…¨æ•°ç»„æ”¯æŒ&quot;">â€‹</a></h3><p><code>@Trace</code> è£…é¥°çš„æ•°ç»„ï¼Œåº•å±‚è¢«æ›¿æ¢ä¸º Proxy å¯¹è±¡ã€‚ <code>this.arr[0] = 100</code> -&gt; è§¦å‘ Proxy set -&gt; é€šçŸ¥ UI æ›´æ–°ã€‚</p><h3 id="_2-3-å…¨å±€çŠ¶æ€-global-store" tabindex="-1">2.3 å…¨å±€çŠ¶æ€ (Global Store) <a class="header-anchor" href="#_2-3-å…¨å±€çŠ¶æ€-global-store" aria-label="Permalink to &quot;2.3 å…¨å±€çŠ¶æ€ (Global Store)&quot;">â€‹</a></h3><p>V2 å¯¹è±¡å¤©ç„¶è„±ç¦»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸã€‚ <code>export const globalUser = new User();</code> å¤šä¸ªé¡µé¢ import è¿™ä¸ªå¯¹è±¡ï¼Œæ”¹ä¸€å¤„ï¼Œå…¨åº”ç”¨åˆ·æ–°ã€‚æ— éœ€å¤æ‚çš„ <code>LocalStorage</code> æˆ– <code>AppStorage</code>ã€‚</p><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Store[&quot;å…¨å±€ç”¨æˆ·å­˜å‚¨&quot;] --&gt;|Import| PageA[&quot;é¡µé¢ A&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Store --&gt;|Import| PageB[&quot;é¡µé¢ B&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Store --&gt;|Import| PageC[&quot;é¡µé¢ C&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PageA --&gt;|ä¿®æ”¹åç§°| Store</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Store --&gt;|Notify| PageB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Store --&gt;|Notify| PageC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    style Store fill:#f96,stroke:#333</span></span></code></pre></div><h2 id="ä¸‰ã€è¿ç§»å»ºè®®" tabindex="-1">ä¸‰ã€è¿ç§»å»ºè®® <a class="header-anchor" href="#ä¸‰ã€è¿ç§»å»ºè®®" aria-label="Permalink to &quot;ä¸‰ã€è¿ç§»å»ºè®®&quot;">â€‹</a></h2><p>V2 æ˜¯æ¨èçš„æ–¹æ¡ˆã€‚</p><ul><li><strong>ä»£ç æ›´ç®€æ´</strong>: ä¸éœ€è¦ <code>this.x = JSON.parse(...)</code>ã€‚</li><li><strong>æ€§èƒ½æ›´å‡ºè‰²</strong>: ç²¾å‡†æ›´æ–°ï¼Œå‡å°‘æ— ç”¨æ¸²æŸ“ã€‚</li></ul><p>ä¸‹ä¸€ç¯‡ï¼Œå°†æ¢è®¨ <strong>åª’ä½“ (Media)</strong> å¼€å‘ï¼Œäº†è§£è§†é¢‘æ’­æ”¾èƒŒåçš„çŠ¶æ€æœºã€‚</p>`,24)])])}const g=a(n,[["render",l]]);export{E as __pageData,g as default};
